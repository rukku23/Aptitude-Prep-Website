<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elevare â€“ Admin Dashboard</title>
  <style>
    :root {
      --bg-main: #050816;
      --bg-surface: #0b1020;
      --bg-surface-soft: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.12);
      --accent-strong: #16a34a;
      --danger: #ef4444;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2933;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-lg: 0 18px 45px rgba(0,0,0,0.55);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #1f2937 0, #020617 45%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Top nav */
    .nav {
      padding: 14px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(148,163,184,0.18);
      backdrop-filter: blur(12px);
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(15,23,42,0.92);
    }

    .nav-left { display: flex; align-items: center; gap: 12px; }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: conic-gradient(from 140deg, #22c55e, #0ea5e9, #6366f1, #22c55e);
      padding: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(34,197,94,0.35);
    }
    .logo-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--accent);
      font-size: 17px;
      letter-spacing: .05em;
    }

    .nav-title { font-size: 20px; font-weight: 600; }
    .nav-sub   { font-size: 12px; color: var(--text-muted); }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .tag {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,118,110,0.18);
      color: #a5f3fc;
      border: 1px solid rgba(45,212,191,0.35);
      font-size: 11px;
      letter-spacing: .06em;
      text-transform: uppercase;
    }

    .logout-btn {
      padding: 7px 16px;
      border-radius: 999px;
      border: none;
      background: rgba(239,68,68,0.14);
      color: #fecaca;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid rgba(248,113,113,0.5);
      transition: background .16s ease, transform .12s ease, box-shadow .12s ease;
      box-shadow: 0 12px 30px rgba(248,113,113,0.18);
    }
    .logout-btn:hover {
      background: rgba(248,113,113,0.28);
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(239,68,68,0.35);
    }

    /* Main layout */
    .page {
      padding: 22px 32px 26px;
      max-width: 1280px;
      margin: 0 auto;
      width: 100%;
      flex: 1;
    }

    .page-header {
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 18px;
    }

    .page-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }
    .page-header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .info-chip {
      font-size: 11px;
      color: #a5b4fc;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(129,140,248,0.7);
      background: rgba(30,64,175,0.25);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .info-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34,197,94,0.8);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 360px) minmax(0, 1.5fr);
      gap: 22px;
      align-items: flex-start;
    }

    @media (max-width: 960px) {
      .page { padding: 18px 16px 22px; }
      .grid { grid-template-columns: minmax(0, 1fr); }
    }

    /* Card styles */
    .card {
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%);
      border-radius: var(--radius-lg);
      padding: 18px;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(148,163,184,0.28);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.15), transparent 55%);
      opacity: .85;
      pointer-events: none;
      mix-blend-mode: screen;
    }
    .card-inner { position: relative; z-index: 1; }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .pill-green {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(34,197,94,0.18);
      color: #bbf7d0;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    /* Form styling */
    form label {
      display: block;
      margin-top: 8px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .two-col-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px 12px;
      margin-top: 2px;
    }

    input, textarea {
      width: 100%;
      padding: 7px 9px;
      margin-top: 3px;
      border-radius: 9px;
      border: 1px solid rgba(55,65,81,0.95);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 12px;
      outline: none;
      transition: border-color .16s ease, box-shadow .16s ease, background .16s ease, transform .06s ease;
    }

    input:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.65), 0 0 30px rgba(34,197,94,0.35);
      background: #020617;
      transform: translateY(-0.5px);
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .btn-primary {
      margin-top: 14px;
      width: 100%;
      padding: 9px 10px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #e5fbea;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 16px 38px rgba(22,163,74,0.55);
      letter-spacing: .03em;
      text-transform: uppercase;
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 55px rgba(34,197,94,0.8);
      filter: brightness(1.05);
    }

    .success {
      margin-top: 9px;
      padding: 7px 9px;
      border-radius: 10px;
      background: rgba(22,163,74,0.18);
      color: #bbf7d0;
      border: 1px solid rgba(34,197,94,0.65);
      font-size: 11px;
      display: none;
    }

    /* Table styles */
    .table-shell {
      margin-top: 4px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(75,85,99,0.85);
      background: radial-gradient(circle at top, #020617 0, #020617 60%);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }

    .table-header-bar {
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(55,65,81,0.95);
      background: linear-gradient(90deg, rgba(34,197,94,0.16), transparent);
      font-size: 12px;
    }

    .table-header-bar span { color: var(--text-muted); }

    .table-count {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(31,41,55,0.95);
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
    }

    .table-scroll {
      max-height: 430px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    th, td {
      padding: 7px 9px;
      text-align: left;
      border-bottom: 1px solid rgba(31,41,55,0.95);
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      z-index: 1;
      background: linear-gradient(90deg, #16a34a, #22c55e);
      color: #ecfdf5;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: 10px;
    }

    tbody tr:nth-child(even) { background: rgba(15,23,42,0.94); }
    tbody tr:nth-child(odd)  { background: rgba(15,23,42,0.82); }

    tbody tr:hover { background: rgba(30,64,175,0.45); }

    td { color: #e5e7eb; font-size: 11px; }

    .skills-cell {
      max-width: 230px;
      white-space: normal;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148,163,184,0.65);
      background: rgba(15,23,42,0.95);
      color: var(--text-muted);
      gap: 4px;
    }

    .pill.success {
      border-color: rgba(34,197,94,0.8);
      background: var(--accent-soft);
      color: #bbf7d0;
    }

    .pill-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: currentColor;
    }

    a.resume-link {
      font-size: 10px;
      text-decoration: none;
      color: #38bdf8;
      margin-top: 3px;
      display: inline-block;
    }
    a.resume-link:hover { text-decoration: underline; }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <header class="nav">
    <div class="nav-left">
      <div class="logo-circle">
        <div class="logo-inner">EV</div>
      </div>
      <div>
        <div class="nav-title">Elevare</div>
        <div class="nav-sub">Admin Control Centre</div>
      </div>
    </div>
    <div class="nav-right">
      <span class="tag">Admin Panel</span>
      <button class="logout-btn" id="btnLogout">Logout</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="page">
    <div class="page-header">
      <div>
        <h2>Student Records &amp; Resumes</h2>
        <p>Manage student master data, monitor resume uploads and feed your UiPath bot from this single view.</p>
      </div>
      <div class="info-chip">
        <span class="info-dot"></span>
        Local demo DB using <strong>browser storage</strong>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: FORM -->
      <section class="card">
        <div class="card-inner">
          <div class="card-title">
            Add / Update Student
            <span class="pill-green">Form</span>
          </div>
          <div class="card-sub">
            Use manually or drive it with your UiPath Excel bot. Existing USN will be updated instead of duplicated.
          </div>

          <form id="studentForm">
            <div class="two-col-row">
              <div>
                <label for="txtUSN">USN</label>
                <input type="text" id="txtUSN" />
              </div>
              <div>
                <label for="txtUID">UID</label>
                <input type="text" id="txtUID" />
              </div>
            </div>

            <label for="txtName">Name</label>
            <input type="text" id="txtName" />

            <div class="two-col-row">
              <div>
                <label for="txtDept">Department</label>
                <input type="text" id="txtDept" placeholder="CSE / ISE / ECE" />
              </div>
              <div>
                <label for="txtYear">Year</label>
                <input type="number" id="txtYear" min="1" max="4" />
              </div>
            </div>

            <label for="txtGPA">GPA</label>
            <input type="text" id="txtGPA" />

            <label for="txtSkills">Skills (comma separated)</label>
            <textarea id="txtSkills" placeholder="React, Node.js, ML, Public Speaking"></textarea>

            <div class="two-col-row">
              <div>
                <label for="txtEmail">Email</label>
                <input type="email" id="txtEmail" />
              </div>
              <div>
                <label for="txtPhone">Phone</label>
                <input type="text" id="txtPhone" />
              </div>
            </div>

            <button type="button" id="btnSubmit" class="btn-primary">Save Student</button>
            <div id="successMsg" class="success">Student record saved to Elevare DB.</div>
          </form>
        </div>
      </section>

      <!-- RIGHT: TABLE -->
      <section class="card">
        <div class="card-inner">
          <div class="card-title">
            Students Database
            <span class="pill-green">Realtime</span>
          </div>
          <div class="card-sub">
            Every entry is stored locally as JSON. Resumes uploaded by students appear here with quick preview links.
          </div>

          <div class="table-shell">
            <div class="table-header-bar">
              <span>LocalStorage collection: <strong>students</strong></span>
              <span class="table-count"><span id="studentCount">0</span> records</span>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>USN</th>
                    <th>UID</th>
                    <th>Name</th>
                    <th>Dept</th>
                    <th>Year</th>
                    <th>GPA</th>
                    <th>Skills</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Resume</th>
                  </tr>
                </thead>
                <tbody id="studentsTableBody">
                  <!-- JS will fill rows -->
                </tbody>
              </table>
            </div>
          </div>

          <p class="hint">
            Tip: Let your UiPath bot iterate over Excel rows and type values into this form.
            The UI instantly reflects changes in the same storage that students read when they log in.
          </p>
        </div>
      </section>
    </div>
  </main>

  <script>
    const STORAGE_KEY = "students";

    // Make sure admin is logged in
    function ensureAdmin() {
      const role = localStorage.getItem("elevare_loggedInRole");
      if (role !== "admin") {
        alert("Please login as admin first.");
        window.location.href = "login.html";
      }
    }
    ensureAdmin();

    // Helpers for DB
    function loadStudents() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.error("Failed to parse students from storage:", e);
        return [];
      }
    }

    function saveStudents(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      console.log("Saved students:", list);
    }

    function updateCount() {
      document.getElementById("studentCount").textContent = loadStudents().length;
    }

    function renderTable() {
      const students = loadStudents();
      const tbody = document.getElementById("studentsTableBody");
      tbody.innerHTML = "";

      students.forEach(s => {
        const tr = document.createElement("tr");

        const skillsShort =
          (s.skills || "").length > 55
            ? (s.skills || "").slice(0, 52) + "..."
            : (s.skills || "");

        let resumeCellHtml = "";
        if (s.resumeData) {
          resumeCellHtml =
            '<div class="pill success"><span class="pill-dot"></span>Uploaded</div>' +
            '<a class="resume-link" href="' +
            s.resumeData +
            '" target="_blank">View</a>';
        } else {
          resumeCellHtml =
            '<div class="pill"><span class="pill-dot"></span>Not uploaded</div>';
        }

        tr.innerHTML =
          "<td>" + (s.usn || "") + "</td>" +
          "<td>" + (s.uid || "") + "</td>" +
          "<td>" + (s.name || "") + "</td>" +
          "<td>" + (s.dept || "") + "</td>" +
          "<td>" + (s.year || "") + "</td>" +
          "<td>" + (s.gpa || "") + "</td>" +
          '<td class="skills-cell">' + skillsShort + "</td>" +
          "<td>" + (s.email || "") + "</td>" +
          "<td>" + (s.phone || "") + "</td>" +
          "<td>" + resumeCellHtml + "</td>";

        tbody.appendChild(tr);
      });

      updateCount();
    }

    function clearForm() {
      document.getElementById("txtUSN").value = "";
      document.getElementById("txtUID").value = "";
      document.getElementById("txtName").value = "";
      document.getElementById("txtDept").value = "";
      document.getElementById("txtYear").value = "";
      document.getElementById("txtGPA").value = "";
      document.getElementById("txtSkills").value = "";
      document.getElementById("txtEmail").value = "";
      document.getElementById("txtPhone").value = "";
    }

    // Save / update student
    document.getElementById("btnSubmit").addEventListener("click", function () {
      const student = {
        usn:   document.getElementById("txtUSN").value.trim(),
        uid:   document.getElementById("txtUID").value.trim(),
        name:  document.getElementById("txtName").value.trim(),
        dept:  document.getElementById("txtDept").value.trim(),
        year:  document.getElementById("txtYear").value.trim(),
        gpa:   document.getElementById("txtGPA").value.trim(),
        skills:document.getElementById("txtSkills").value.trim(),
        email: document.getElementById("txtEmail").value.trim(),
        phone: document.getElementById("txtPhone").value.trim()
      };

      if (!student.usn || !student.email) {
        alert("USN and Email are required.");
        return;
      }

      const students = loadStudents();

      // find existing by USN or email
      const index = students.findIndex(
        s => s.usn === student.usn || s.email === student.email
      );

      if (index >= 0) {
        // keep previous resumeData if present
        const old = students[index];
        student.resumeData = old.resumeData || null;
        students[index] = student;
      } else {
        student.resumeData = null;
        students.push(student);
      }

      saveStudents(students);
      renderTable();
      clearForm();

      const msg = document.getElementById("successMsg");
      msg.style.display = "block";
      setTimeout(() => { msg.style.display = "none"; }, 1500);
    });

    // Logout
    document.getElementById("btnLogout").addEventListener("click", function () {
      localStorage.removeItem("elevare_loggedInRole");
      window.location.href = "login.html";
    });

    // Initial render
    window.addEventListener("load", function () {
      renderTable();
    });
  </script>
</body>
</html>
